{"ts":1368216987951,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/* jshint undef: true, unused: true */\n/* global Ext  */\n(function() {\n\n    Ext.define('Ext.oj-sqlbuilder.SQLFieldsGrid', {\n        requires: ['Ext.ux.CheckColumn'],\n        extend: 'Ext.grid.Panel',\n        alias: ['widget.sqlfieldsgrid'],\n        id: 'SQLFieldsGrid',\n        store: 'SQLFieldsStore',\n        columnLines: true,\n        plugins: [Ext.create('Ext.grid.plugin.CellEditing', {\n            clicksToEdit: 1\n        })],\n        viewConfig: {\n            listeners: {\n                render: function(view) {\n                    this.dd = {};\n                    this.dd.dropZone = new Ext.grid.ViewDropZone({\n                        view: view,\n                        ddGroup: 'SQLTableGridDDGroup',\n                        handleNodeDrop: function(data, record, position) {\n                            // Was soll nach dem Drop passieren?\n                        }\n                    });\n                },\n                drop: function(node, data, dropRec, dropPosition) {\n                    // add new rows to the SQLFieldsGrid after a drop\n                    for (var i = 0, l = data.records.length; i < l; i++) {\n                        oj.sql.builder.sqlSelect.addFieldRecord(data.records[i], false);\n                    }\n                }\n            }\n        },\n        columns: [{\n            xtype: 'actioncolumn',\n            menuDisabled: true,\n            text: 'Action',\n            width: 60,\n            moveGridRow: function(grid, record, index, direction) {\n                var store = grid.getStore();\n                if (direction < 0) {\n                    index--;\n                    if (index < 0) {\n                        return;\n                    }\n                }\n                else {\n                    index++;\n                    if (index >= grid.getStore().getCount()) {\n                        return;\n                    }\n                }\n                // prepare manual syncing\n                store.suspendAutoSync();\n                // disable firing store events\n                store.suspendEvents();\n                // remove record and insert record at new index\n                store.remove(record);\n                store.insert(index, record);\n                // enable firing store events\n                store.resumeEvents();\n                store.resumeAutoSync();\n                // manual sync the store\n                store.sync();\n            },\n            items: [{\n                icon: 'resources/images/up_arrow.gif',\n                tooltip: 'Move Column Up',\n                getClass: function(value, metadata, record) {\n                    var store, index;\n                    store = record.store;\n                    index = store.indexOf(record);\n                    if (index == 0) {\n                        return 'x-action-icon-disabled';\n                    }\n                    else {\n                        return 'x-grid-center-icon';\n                    }\n                },\n                handler: function(grid, rowIndex, colIndex) {\n                    var rec = grid.getStore().getAt(rowIndex);\n                    this.moveGridRow(grid, rec, rowIndex, - 1);\n                }\n            }, {\n                icon: 'resources/images/down_arrow.gif',\n                getClass: function(value, metadata, record) {\n                    var store, index;\n                    store = record.store;\n                    index = store.indexOf(record);\n                    if ((index + 1) == store.getCount()) {\n                        return 'x-action-icon-disabled';\n                    }\n                    else {\n                        return 'x-grid-center-icon';\n                    }\n                },\n                tooltip: 'Move Column Down',\n                handler: function(grid, rowIndex, colIndex) {\n                    var rec = grid.getStore().getAt(rowIndex);\n                    this.moveGridRow(grid, rec, rowIndex, 1);\n                }\n            }, {\n                icon: 'resources/images/remove.gif',\n                iconCls: 'x-grid-center-icon',\n                tooltip: 'Delete Column',\n                handler: function(grid, rowIndex, colIndex) {\n                    var rec = grid.getStore().getAt(rowIndex),\n                        store, tableId, tableGrid, selectionModel, bDel = true;\n                    // rec contains column grid model, the one to remove\n                    // get tableId of original sqltable\n                    tableId = rec.get('extCmpId');\n                    // get the sql tables grid and its selection\n                    tableGrid = Ext.getCmp(tableId).down('gridpanel');\n                    selectionModel = tableGrid.getSelectionModel();\n                    Ext.Array.each(selectionModel.getSelection(), function(selection) {\n                        // deselect the selection wich corresponds to the column\n                        // we want to remove from the column grid\n                        if (rec.get('id') == selection.get('id')) {\n                            // deselect current selection\n                            // deselection will lead to removal, look for method deselect at the SQLTableGrid\n                            selectionModel.deselect(selection);\n                            bDel = false;\n                        }\n                    });\n                    if (bDel) {\n                        store = grid.getStore();\n                        store.remove(rec);\n                    }\n                }\n            }]\n        }, OJ.columns.checkColumn(false, 'Output', true),\n           OJ.columns.gridColumn(false, 'Expression' )\n         {\n            xtype: 'gridcolumn',\n            text: 'Expression',\n            sortable: false,\n            menuDisabled: true,\n            flex: 0.225,\n            dataIndex: 'expression',\n            editor: 'textfield'\n        }, {\n            xtype: 'gridcolumn',\n            text: 'Aggregate',\n            flex: 0.125,\n            sortable: false,\n            menuDisabled: true,\n            dataIndex: 'aggregate',\n            editor: 'textfield'\n        }, {\n            xtype: 'gridcolumn',\n            text: 'Alias',\n            flex: 0.125,\n            sortable: false,\n            menuDisabled: true,\n            dataIndex: 'alias',\n            editor: 'textfield'\n        }, {\n            xtype: 'gridcolumn',\n            text: 'Sort Type',\n            flex: 0.125,\n            sortable: false,\n            menuDisabled: true,\n            dataIndex: 'sorttype'\n        }, {\n            xtype: 'gridcolumn',\n            text: 'Sort Order',\n            flex: 0.125,\n            sortable: false,\n            menuDisabled: true,\n            dataIndex: 'sortorder'\n        }, {\n            xtype: 'checkcolumn',\n            text: 'Grouping',\n            flex: 0.075,\n            sortable: false,\n            menuDisabled: true,\n            dataIndex: 'grouping',\n            align: 'center'\n        }, {\n            xtype: 'gridcolumn',\n            text: 'Criteria',\n            flex: 0.125,\n            sortable: false,\n            menuDisabled: true,\n            dataIndex: 'criteria',\n            editor: 'textfield'\n        }],\n        initComponent: function() {\n            this.callParent(arguments);\n        }\n    });\n\n}());"]],"start1":0,"start2":0,"length1":0,"length2":7278}]],"length":7278}
